# 逆解析 (ASCII to DSL) 仕様案

ASCIIwireのレンダラーが出力したアスキーアートから、元のDSL構造を復元するための解析仕様です。

## 基本方針

- **対象**: 自ライブラリ（`@asciiwire/core`）が出力したアスキーアートに限定。
- **アプローチ**: 外側の枠線から順に剥きながら、再帰的にコンポーネントとレイアウトを特定する。

## 構造特定アルゴリズム

### 1. コンポーネント枠線の識別
行の開始と終了、および使用されている文字から種類を判定します。

| 枠線文字 | 推定コンポーネント |
|:---|:---|
| `====` | `header` |
| `+---+` | `panel` |
| `+....+` | `default` |

### 2. レイアウトの特定 (Split)
- **垂直スキャン**: 全ての行について、同じ列位置に ` | ` (スペース-パイプ-スペース) が垂直に並んでいるカラムを探します。
- **分割点**: 垂直な区切りが見つかった場合、そのカラムを境界として左右のエリアに分割します。
- **比率の推論**: 
  - `(左側の幅 / 全体の幅) * 100` を計算し、最も近い整数の比率（例: 30/70）を算出します。

### 3. 再帰的解析
1. 入力テキストの最外周にある枠線を取り除き、中のコンテンツを抽出する。
2. 抽出したコンテンツ内に「垂直分割線」がないかスキャンする。
   - あれば `split` レイアウトとして左右に分け、それぞれに対して手順1を再帰適用する。
   - なければ、そのエリアを一つのコンポーネントまたはテキストとして処理する。

### 4. コンテンツのリファクタリング
- **テーブルの復元**: 
  - 中身が `| cell | cell |` の形式であれば、`table` コンポーネントとして解析。
- **リストの復元**: 
  - 行頭が `- ` であれば `list` コンポーネントとして解析。

## 課題と対策

- **曖昧性の排除**: 
  - コンテンツ内に偶然 `+---+` などが含まれる場合、最外周の枠線との距離や一貫性をチェックして無視するロジックが必要。
- **微細なズレ**: 
  - 人間による手修正で1文字ズレた場合でも動作を継続できるよう、ある程度の容認幅（Fuzzy matching）を持たせる。

## 将来的な拡張

- **メタデータタグ**: 
  - アスキーアートの末尾に不可視（または目立たないHTMLコメント形式）で元のJSON ASTを埋め込むオプションを用意し、完全な復元を保証する。
